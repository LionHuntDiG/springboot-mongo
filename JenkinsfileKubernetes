node{
    
    stage("git clone"){
        
        git credentialsId: 'girhub_cred', url: 'https://github.com/LionHuntDiG/springboot-mongo.git'
 
         }
   stage("Maven build"){
     def mavenHome = tool name:"Maven-3.6.1", type: "maven"  
     def mavenCMD  = "${mavenHome}/bin/mvn"
     sh "${mavenCMD} clean package"
   }
    stage("docker build"){
      sh "docker build -t shaacr.azurecr.io/spring-mongo:${BUILD_NUMBER} ."   
    }
    stage("docker push"){
       withCredentials([string(credentialsId: 'ACR_HUB', variable: 'ACR_HUB')]) {
       sh " docker login shaacr.azurecr.io -u shaACR -p ${ACR_HUB} "
       }
        sh "docker push shaacr.azurecr.io/spring-mongo:${BUILD_NUMBER}"
    }
    stage("login to AKS"){
       kubernetesDeploy(
           configs: 'springBootMongo.yaml',
           kubeconfigId: 'k8s-config',
           enableConfigSubstitution: true
     )     
    }
    
}



